<div align="center">
<h1>ChatGPT Dingtalk</h1>

[![Auth](https://img.shields.io/badge/Auth-eryajf-ff69b4)](https://github.com/eryajf)
[![Go Version](https://img.shields.io/github/go-mod/go-version/eryajf/chatgpt-dingtalk)](https://github.com/eryajf/chatgpt-dingtalk)
[![GitHub Pull Requests](https://img.shields.io/github/issues-pr/eryajf/chatgpt-dingtalk)](https://github.com/eryajf/chatgpt-dingtalk/pulls)
[![GitHub Pull Requests](https://img.shields.io/github/stars/eryajf/chatgpt-dingtalk)](https://github.com/eryajf/chatgpt-dingtalk/stargazers)
[![HitCount](https://views.whatilearened.today/views/github/eryajf/chatgpt-dingtalk.svg)](https://github.com/eryajf/chatgpt-dingtalk)
[![Docker Image Size (latest by date)](https://img.shields.io/docker/image-size/eryajf/chatgpt-dingtalk)](https://hub.docker.com/r/eryajf/chatgpt-dingtalk)
[![Docker Pulls](https://img.shields.io/docker/pulls/eryajf/chatgpt-dingtalk)](https://hub.docker.com/r/eryajf/chatgpt-dingtalk)
[![GitHub license](https://img.shields.io/github/license/eryajf/chatgpt-dingtalk)](https://github.com/eryajf/chatgpt-dingtalk/blob/main/LICENSE)

<p> ğŸŒ‰ åœ¨é’‰é’‰ç¾¤èŠä¸­æ·»åŠ ChatGPTæœºå™¨äºº ğŸŒ‰</p>

<img src="https://camo.githubusercontent.com/82291b0fe831bfc6781e07fc5090cbd0a8b912bb8b8d4fec0696c881834f81ac/68747470733a2f2f70726f626f742e6d656469612f394575424971676170492e676966" width="800"  height="3">
</div><br>


## å‰è¨€

æœ€è¿‘ChatGPTå¼‚å¸¸ç«çˆ†ï¼Œæœ¬é¡¹ç›®å¯ä»¥åŠ©ä½ å°†GPTæœºå™¨äººé›†æˆåˆ°é’‰é’‰ç¾¤èŠä¸­ã€‚


> ğŸ¥³ **æ¬¢è¿å…³æ³¨æˆ‘çš„å…¶ä»–å¼€æºé¡¹ç›®ï¼š**
>
> - [Go-Ldap-Admin](https://github.com/eryajf/go-ldap-admin)ï¼šğŸŒ‰ åŸºäºGo+Vueå®ç°çš„openLDAPåå°ç®¡ç†é¡¹ç›®ã€‚
> - [learning-weekly](https://github.com/eryajf/learning-weekly)ï¼šğŸ“ å‘¨åˆŠå†…å®¹ä»¥è¿ç»´æŠ€æœ¯å’ŒGoè¯­è¨€å‘¨è¾¹ä¸ºä¸»ï¼Œè¾…ä»¥GitHubä¸Šä¼˜ç§€é¡¹ç›®æˆ–ä»–äººä¼˜ç§€ç»éªŒã€‚
> - [HowToStartOpenSource](https://github.com/eryajf/HowToStartOpenSource)ï¼šğŸŒˆ GitHubå¼€æºé¡¹ç›®ç»´æŠ¤ååŒæŒ‡å—ã€‚
> - [read-list](https://github.com/eryajf/read-list)ï¼šğŸ“– ä¼˜è´¨å†…å®¹è®¢é˜…ï¼Œé˜…è¯»æ–¹ä¸ºæ ¹æœ¬
> - [awesome-github-profile-readme-chinese](https://github.com/eryajf/awesome-github-profile-readme-chinese)ï¼šğŸ¦© ä¼˜ç§€çš„ä¸­æ–‡åŒºä¸ªäººä¸»é¡µæœé›†


## åŠŸèƒ½ç®€ä»‹

* æ”¯æŒåœ¨é’‰é’‰ç¾¤èŠä¸­æ·»åŠ æœºå™¨äººï¼Œé€šè¿‡@æœºå™¨äººè¿›è¡ŒèŠå¤©äº¤äº’ã€‚
* æé—®æ”¯æŒå•èŠä¸ä¸²èŠä¸¤ç§æ¨¡å¼ï¼Œé€šè¿‡@æœºå™¨äººå‘å…³é”®å­—åˆ‡æ¢ã€‚

## ä½¿ç”¨å‰æ

* æœ‰Openaiè´¦å·ï¼Œå¹¶ä¸”åˆ›å»ºå¥½`api_key`ï¼Œæ³¨å†Œç›¸å…³äº‹é¡¹å¯ä»¥å‚è€ƒ[æ­¤æ–‡ç« ](https://juejin.cn/post/7173447848292253704) ã€‚è®¿é—®[è¿™é‡Œ](https://beta.openai.com/account/api-keys)ï¼Œç”³è¯·ä¸ªäººç§˜é’¥ã€‚
* åœ¨é’‰é’‰å¼€å‘è€…åå°åˆ›å»ºæœºå™¨äººï¼Œé…ç½®åº”ç”¨ç¨‹åºå›è°ƒã€‚

## ä½¿ç”¨æ•™ç¨‹

### ç¬¬ä¸€æ­¥ï¼Œå…ˆåˆ›å»ºæœºå™¨äºº

åˆ›å»ºæ­¥éª¤å‚è€ƒæ–‡æ¡£ï¼š[ä¼ä¸šå†…éƒ¨å¼€å‘æœºå™¨äºº](https://open.dingtalk.com/document/robots/enterprise-created-chatbot)ï¼Œæˆ–è€…æ ¹æ®å¦‚ä¸‹æ­¥éª¤è¿›è¡Œé…ç½®ã€‚

1. åˆ›å»ºæœºå™¨äººã€‚
   ![image_20221209_163616](https://cdn.staticaly.com/gh/eryajf/tu/main/img/image_20221209_163616.png)

   > `ğŸ“¢ æ³¨æ„ï¼š`å¯èƒ½ç°åœ¨åˆ›å»ºæœºå™¨äººçš„æ—¶å€™åå­—ä¸º`chatgpt`ä¼šè¢«é’‰é’‰é™åˆ¶ï¼Œè¯·ç”¨å…¶ä»–åå­—å‘½åã€‚

   æ­¥éª¤æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚

2. é…ç½®æœºå™¨äººå›è°ƒæ¥å£ã€‚
   ![image_20221209_163652](https://cdn.staticaly.com/gh/eryajf/tu/main/img/image_20221209_163652.png)

   åˆ›å»ºå®Œæ¯•ä¹‹åï¼Œç‚¹å‡»æœºå™¨äººå¼€å‘ç®¡ç†ï¼Œç„¶åé…ç½®å°†è¦éƒ¨ç½²çš„æœåŠ¡æ‰€åœ¨æœåŠ¡å™¨çš„å‡ºå£IPï¼Œä»¥åŠå°†è¦ç»™æœåŠ¡é…ç½®çš„åŸŸåã€‚

3. å‘å¸ƒæœºå™¨äººã€‚
   ![image_20221209_163709](https://cdn.staticaly.com/gh/eryajf/tu/main/img/image_20221209_163709.png)

   ç‚¹å‡»ç‰ˆæœ¬ç®¡ç†ä¸å‘å¸ƒï¼Œç„¶åç‚¹å‡»ä¸Šçº¿ï¼Œè¿™ä¸ªæ—¶å€™å°±èƒ½åœ¨é’‰é’‰çš„ç¾¤é‡Œä¸­æ·»åŠ è¿™ä¸ªæœºå™¨äººäº†ã€‚

4. ç¾¤èŠæ·»åŠ æœºå™¨äººã€‚

   ![image_20221209_163724](https://cdn.staticaly.com/gh/eryajf/tu/main/img/image_20221209_163724.png)

### ç¬¬äºŒæ­¥ï¼Œéƒ¨ç½²åº”ç”¨

ä½ å¯ä»¥ä½¿ç”¨dockerå¿«é€Ÿè¿è¡Œæœ¬é¡¹ç›®ã€‚

`ç¬¬ä¸€ç§ï¼šåŸºäºç¯å¢ƒå˜é‡è¿è¡Œ`

```sh
# è¿è¡Œé¡¹ç›®
$ docker run -itd --name chatgpt -p 8090:8090 -e APIKEY=æ¢æˆä½ çš„key -e SESSION_TIMEOUT=600 --restart=always  dockerproxy.com/eryajf/chatgpt-dingtalk:latest
```

è¿è¡Œå‘½ä»¤ä¸­æ˜ å°„çš„é…ç½®æ–‡ä»¶å‚è€ƒä¸‹è¾¹çš„é…ç½®æ–‡ä»¶è¯´æ˜ã€‚

`ç¬¬äºŒç§ï¼šåŸºäºé…ç½®æ–‡ä»¶æŒ‚è½½è¿è¡Œ`

```sh
# å¤åˆ¶é…ç½®æ–‡ä»¶ï¼Œæ ¹æ®è‡ªå·±å®é™…æƒ…å†µï¼Œè°ƒæ•´é…ç½®é‡Œçš„å†…å®¹
$ cp config.dev.json config.json  # å…¶ä¸­ config.dev.json ä»é¡¹ç›®çš„æ ¹ç›®å½•è·å–

# è¿è¡Œé¡¹ç›®
$ docker run -itd --name chatgpt -p 8090:8090  -v `pwd`/config.json:/app/config.json --restart=always  dockerproxy.com/eryajf/chatgpt-dingtalk:latest
```

å…¶ä¸­é…ç½®æ–‡ä»¶å‚è€ƒä¸‹è¾¹çš„é…ç½®æ–‡ä»¶è¯´æ˜ã€‚

æ³¨æ„ï¼Œä¸è®ºé€šè¿‡ä¸Šè¾¹å“ªç§dockeræ–¹å¼éƒ¨ç½²ï¼Œéƒ½éœ€è¦é…ç½®Nginxä»£ç†ï¼Œå½“ç„¶ä½ ç›´æ¥é€šè¿‡æœåŠ¡å™¨å¤–ç½‘IPä¹Ÿå¯ä»¥ã€‚

éƒ¨ç½²å®Œæˆä¹‹åï¼Œé€šè¿‡Nginxä»£ç†æœ¬æœåŠ¡ï¼š

```nginx
server {
    listen       80;
    server_name  chat.eryajf.net;

    client_header_timeout 120s;
    client_body_timeout 120s;

    location / {
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-For $remote_addr;
        proxy_pass http://localhost:8090;
    }
}
```

éƒ¨ç½²å®Œæˆä¹‹åï¼Œå°±å¯ä»¥åœ¨ç¾¤é‡Œè‰¾ç‰¹æœºå™¨äººè¿›è¡Œä½“éªŒäº†ã€‚

Nginxé…ç½®å®Œæ¯•ä¹‹åï¼Œå¯ä»¥å…ˆæ‰‹åŠ¨è¯·æ±‚ä¸€ä¸‹ï¼Œé€šè¿‡æœåŠ¡æ—¥å¿—è¾“å‡ºåˆ¤æ–­æœåŠ¡æ˜¯å¦æ­£å¸¸å¯ç”¨ï¼š

```sh
$ curl --location --request POST 'http://chat.eryajf.net/' \
  --header 'Content-type: application/json' \
  --data-raw '{
    "conversationId": "xxx",
    "atUsers": [
        {
            "dingtalkId": "xxx",
            "staffId":"xxx"
        }
    ],
    "chatbotCorpId": "dinge8a565xxxx",
    "chatbotUserId": "$:LWCP_v1:$Cxxxxx",
    "msgId": "msg0xxxxx",
    "senderNick": "eryajf",
    "isAdmin": true,
    "senderStaffId": "user123",
    "sessionWebhookExpiredTime": 1613635652738,
    "createAt": 1613630252678,
    "senderCorpId": "dinge8a565xxxx",
    "conversationType": "2",
    "senderId": "$:LWCP_v1:$Ff09GIxxxxx",
    "conversationTitle": "æœºå™¨äººæµ‹è¯•-TEST",
    "isInAtList": true,
    "sessionWebhook": "https://oapi.dingtalk.com/robot/sendBySession?session=xxxxx",
    "text": {
        "content": " ä½ å¥½"
    },
    "msgtype": "text"
}'
```

å¦‚æœæ‰‹åŠ¨è¯·æ±‚æ²¡æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨é’‰é’‰ç¾¤é‡Œä¸æœºå™¨äººè¿›è¡Œå¯¹è¯äº†ã€‚

`å¸®åŠ©åˆ—è¡¨`

> è‰¾ç‰¹æœºå™¨äººå‘é€ç©ºå†…å®¹æˆ–è€…å¸®åŠ©ï¼Œä¼šè¿”å›å¸®åŠ©åˆ—è¡¨ã€‚

![image_20230215_184402](https://cdn.staticaly.com/gh/eryajf/tu/main/img/image_20230215_184402.png)

`åˆ‡æ¢æ¨¡å¼`

> å‘é€æŒ‡å®šå…³é”®å­—ï¼Œå¯ä»¥åˆ‡æ¢ä¸åŒçš„æ¨¡å¼ã€‚

![image_20230215_184655](https://cdn.staticaly.com/gh/eryajf/tu/main/img/image_20230215_184655.png)

> ğŸ“¢ æ³¨æ„ï¼šä¸²èŠæ¨¡å¼ä¸‹ï¼Œç¾¤é‡Œæ¯ä¸ªäººçš„èŠå¤©ä¸Šä¸‹æ–‡æ˜¯ç‹¬ç«‹çš„ã€‚
> ğŸ“¢ æ³¨æ„ï¼šé»˜è®¤å¯¹è¯æ¨¡å¼ä¸ºå•èŠï¼Œå› æ­¤ä¸å¿…å‘é€å•èŠå³å¯è¿›å…¥å•èŠæ¨¡å¼ï¼Œè€Œè¦è¿›å…¥ä¸²èŠï¼Œåˆ™éœ€è¦å‘é€ä¸²èŠå…³é”®å­—è¿›è¡Œåˆ‡æ¢ï¼Œå½“ä¸²èŠå†…å®¹è¶…è¿‡æœ€å¤§é™åˆ¶çš„æ—¶å€™ï¼Œä½ å¯ä»¥å‘é€é‡ç½®ï¼Œç„¶åå†æ¬¡è¿›å…¥ä¸²èŠæ¨¡å¼ã€‚

`å®é™…èŠå¤©æ•ˆæœå¦‚ä¸‹`

![image_20221209_163739](https://cdn.staticaly.com/gh/eryajf/tu/main/img/image_20221209_163739.png)

---

å¦‚æœä½ æƒ³é€šè¿‡å‘½ä»¤è¡Œç›´æ¥éƒ¨ç½²ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½releaseä¸­çš„[å‹ç¼©åŒ…](https://github.com/eryajf/chatgpt-dingtalk/releases) ï¼Œè¯·æ ¹æ®è‡ªå·±ç³»ç»Ÿä»¥åŠæ¶æ„é€‰æ‹©åˆé€‚çš„å‹ç¼©åŒ…ï¼Œä¸‹è½½ä¹‹åç›´æ¥è§£å‹è¿è¡Œã€‚

ä¸‹è½½ä¹‹åï¼Œåœ¨æœ¬åœ°è§£å‹ï¼Œå³å¯çœ‹åˆ°å¯æ‰§è¡Œç¨‹åºï¼Œä¸é…ç½®æ–‡ä»¶ï¼š

```
$ tar xf chatgpt-dingtalk-v0.0.4-darwin-arm64.tar.gz
$ cd chatgpt-dingtalk-v0.0.4-darwin-arm64
$ cp config.dev.json # æ ¹æ®æƒ…å†µè°ƒæ•´é…ç½®æ–‡ä»¶å†…å®¹
$ ./chatgpt-dingtalk  # ç›´æ¥è¿è¡Œ

# å¦‚æœè¦å®ˆæŠ¤åœ¨åå°è¿è¡Œ
$ nohup ./chatgpt-dingtalk &> run.log &
$ tail -f run.log
```


## æœ¬åœ°å¼€å‘

```sh
# è·å–é¡¹ç›®
$ git clone https://github.com/eryajf/chatgpt-dingtalk.git

# è¿›å…¥é¡¹ç›®ç›®å½•
$ cd chatgpt-dingtalk

# å¤åˆ¶é…ç½®æ–‡ä»¶ï¼Œæ ¹æ®ä¸ªäººå®é™…æƒ…å†µè¿›è¡Œé…ç½®
$ cp config.dev.json config.json

# å¯åŠ¨é¡¹ç›®
$ go run main.go
```

## é…ç½®æ–‡ä»¶è¯´æ˜

```json
{
    "api_key": "xxxxxxxxx",  // openai api_key
    "session_timeout": 600   // ä¼šè¯è¶…æ—¶æ—¶é—´,é»˜è®¤600ç§’,åœ¨ä¼šè¯æ—¶é—´å†…æ‰€æœ‰å‘é€ç»™æœºå™¨äººçš„ä¿¡æ¯ä¼šä½œä¸ºä¸Šä¸‹æ–‡
}
```

## å¸¸è§é—®é¢˜

ä¸€äº›å¸¸è§çš„é—®é¢˜ï¼Œæˆ‘å•ç‹¬å¼€issueæ”¾åœ¨è¿™é‡Œï¼š[ç‚¹æˆ‘](https://github.com/eryajf/chatgpt-dingtalk/issues/44)ï¼Œå¯ä»¥æŸ¥çœ‹è¿™é‡Œè¾…åŠ©ä½ è§£å†³é—®é¢˜ï¼Œå¦‚æœé‡Œè¾¹æ²¡æœ‰ï¼Œè¯·å¯¹å†å²issueè¿›è¡Œæœç´¢(ä¸è¦æäº¤é‡å¤çš„issue)ï¼Œä¹Ÿæ¬¢è¿å¤§å®¶è¡¥å……ã€‚

## é«˜å…‰æ—¶åˆ»

> æœ¬é¡¹ç›®æ›¾åœ¨[2022-12-12](https://github.com/bonfy/github-trending/blob/master/2022/2022-12-12.md#go),[2022-12-18](https://github.com/bonfy/github-trending/blob/master/2022/2022-12-18.md#go),[2022-12-19](https://github.com/bonfy/github-trending/blob/master/2022/2022-12-19.md#go),[2022-12-20](https://github.com/bonfy/github-trending/blob/master/2022/2022-12-20.md#go),[2023-02-09](https://github.com/bonfy/github-trending/blob/master/2023-02-09.md#go),[2023-02-10](https://github.com/bonfy/github-trending/blob/master/2023-02-10.md#go),[2023-02-11](https://github.com/bonfy/github-trending/blob/master/2023-02-11.md#go),[2023-02-12](https://github.com/bonfy/github-trending/blob/master/2023-02-12.md#go)ï¼Œè¿™äº›å¤©é‡Œï¼Œç™»ä¸ŠGitHub Trendingã€‚è€Œä¸”è¿˜åœ¨æŒç»­ç™»æ¦œä¸­ï¼Œå¯è§æœ€è¿‘openaiçš„çƒ­åº¦ã€‚
> ![image_20230215_094034](https://cdn.staticaly.com/gh/eryajf/tu/main/img/image_20230215_094034.png)